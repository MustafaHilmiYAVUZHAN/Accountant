

import pandas as pd
from openpyxl import load_workbook
from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas
from io import BytesIO
from subprocess import run
from time import sleep

class ExcelTableCreator:
    def __init__(self, data, filename="Data\\Table.xlsx"):
        """
        Excel dosyası oluşturur ve başlık, veri, görsel ekler.

        :param filename: Çıktı dosyasının adı
        :param data: Veri listesi
        :param image: Eklenecek görsel dosyası (isteğe bağlı)
        """
        self.filename = filename
        self.data = data
        # Load the existing workbook or create a new one
        
        self.workbook = load_workbook(self.filename)
        

        # Remove 'Data' worksheet if it exists
        if 'Data' in self.workbook.sheetnames:
            del self.workbook['Data']

        # Create a new 'Data' worksheet
        self.worksheet = self.workbook.create_sheet('Data')

        # Hide the 'Data' worksheet
        self.worksheet.sheet_state = 'hidden'

        # Modify the worksheet (e.g., write some data)
        self.write_data()
        
        self.workbook.save(self.filename)

    def write_data(self):

        for i, row in enumerate(self.data):
            for j, value in enumerate(row):
                self.worksheet.cell(row=i+1, column=j+1, value=str(value))
                print(value)

        
class ExcelTableConcubines:
    def __init__(self, data, filename="Data\\Table.xlsx"):
        """
        Excel dosyası oluşturur ve başlık, veri, görsel ekler.

        :param filename: Çıktı dosyasının adı
        :param data: Veri listesi
        :param image: Eklenecek görsel dosyası (isteğe bağlı)
        """
        self.filename = filename
        self.data = data
        # Load the existing workbook or create a new one
        
        self.workbook = load_workbook(self.filename)
        


        # Remove 'Data' worksheet if it exists
        if 'Data' in self.workbook.sheetnames:
            del self.workbook['Data']

        # Create a new 'Data' worksheet
        self.worksheet = self.workbook.create_sheet('concubines')

        # Hide the 'Data' worksheet
        self.worksheet.sheet_state = 'hidden'

        # Modify the worksheet (e.g., write some data)
        self.write_data()
        
        self.workbook.save(self.filename)

    def write_data(self):

        for i, row in enumerate(self.data):
            for j, value in enumerate(row):
                self.worksheet.cell(row=i+1, column=j+1, value=str(value))
                print(value)


class ExcelToPDFConverter:
    def __init__(self, sheet_name,libre_path, excel_file="Data\\Table.xlsx"):
        self.excel_file=excel_file
        self.workbook = load_workbook(excel_file)
        self.libre_path=libre_path
        if sheet_name=="special":
            self.workbook['Main'].sheet_state = "hidden"
            self.workbook['special'].sheet_state = "visible"
            self.to_pdf()
        elif sheet_name=="main":
            self.workbook['Main'].sheet_state = "visible"
            self.workbook['special'].sheet_state = "hidden"
            self.to_pdf()
        else :
            print("sheet name is main or special")

    def to_pdf(self):
        print("hi")
        self.workbook.save(self.excel_file)
        sleep(2)
        run([self.libre_path,"--headless" ,"--convert-to", "pdf" ,r"Data\Table.xlsx","--outdir","Data\\"], capture_output=True, text=True, shell=True)
