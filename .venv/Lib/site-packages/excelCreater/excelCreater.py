

import pandas as pd
from openpyxl import load_workbook
from reportlab.lib.pagesizes import letter
from reportlab.pdfgen import canvas
from io import BytesIO
from subprocess import run
from time import sleep

class ExcelTableCreator:
    def __init__(self, data, filename="data\\Table.xlsx"):
        """
        Excel dosyası oluşturur ve başlık, veri, görsel ekler.

        :param filename: Çıktı dosyasının adı
        :param data: Veri listesi
        :param image: Eklenecek görsel dosyası (isteğe bağlı)
        """
        self.filename = filename
        self.data = data
        # Load the existing workbook or create a new one
        
        self.workbook = load_workbook(self.filename)
        

        # Remove 'Data' worksheet if it exists
        if 'Data' in self.workbook.sheetnames:
            del self.workbook['Data']

        # Create a new 'Data' worksheet
        self.worksheet = self.workbook.create_sheet('Data')

        # Hide the 'Data' worksheet
        self.worksheet.sheet_state = 'hidden'

        # Modify the worksheet (e.g., write some data)
        self.write_data()
        
        self.workbook.save(self.filename)

    def write_data(self):

        for i, row in enumerate(self.data):
            for j, value in enumerate(row):
                self.worksheet.cell(row=i+1, column=j+1, value=str(value))

        
class ExcelTableConcubines:
    def __init__(self, data, filename="data\\STable.xlsx"):
        """
        Excel dosyası oluşturur ve başlık, veri, görsel ekler.

        :param filename: Çıktı dosyasının adı
        :param data: Veri listesi
        :param image: Eklenecek görsel dosyası (isteğe bağlı)
        """
        self.filename = filename
        self.data = data
        # Load the existing workbook or create a new one
        
        self.workbook = load_workbook(self.filename)
        


        # Remove 'Data' worksheet if it exists
        if 'Data' in self.workbook.sheetnames:
            del self.workbook['concubines']

        # Create a new 'Data' worksheet
        self.worksheet = self.workbook.create_sheet('concubines')

        # Hide the 'Data' worksheet
        self.worksheet.sheet_state = 'hidden'

        # Modify the worksheet (e.g., write some data)
        self.write_data()
        
        self.workbook.save(self.filename)

    def write_data(self):

        for i, row in enumerate(self.data):
            for j, value in enumerate(row):
                self.worksheet.cell(row=i+1, column=j+1, value=str(value))


class ExcelToPDFConverter:
    def __init__(self, sheet_name,libre_path, excel_file="data\\Table.xlsx"):
        self.excel_file=excel_file
        self.workbook = load_workbook(excel_file)
        self.libre_path=libre_path
        self.to_pdf()

    def to_pdf(self):
        self.workbook.save(self.excel_file)
        sleep(0.2)
        run([self.libre_path,"--headless" ,"--convert-to", "pdf" ,self.excel_file,"--outdir","data\\"], capture_output=True, text=True, shell=True)
